:root{
  --bg: #f5f7fb;
  --fg: #111;
  --muted: #616161;
  --brand: #6b6ff7;
  --card: #fff;
  --border: #e6e8ef;
  --ok: #2e7d32;
  --err: #c62828;
  --focus: #1a73e8;
  --lamp: #bbb;
  --lamp-on: #1a73e8;
  --lamp-sub: #9c27b0;
}

[data-theme="dark"]{
  --bg: #121212;
  --fg: #f5f7fb;
  --muted: #bbb;
  --brand: #6b6ff7;
  --card: #1e1e1e;
  --border: #333;
  --ok: #66bb6a;
  --err: #ef5350;
  --focus: #8ab4f8;
  --lamp: #555;
  --lamp-on: #8ab4f8;
  --lamp-sub: #ce93d8;
}

*{ box-sizing: border-box; }
body{
  margin:0;
  background: var(--bg);
  color: var(--fg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

.topbar{ 
  display:flex;
  align-items:center;
  gap:12px;
  padding:16px 20px;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg, #fff, #fbfbff);
}
.topbar .logo{ font-size:24px }
.topbar h1{ margin:0; font-size:20px; font-weight:700; letter-spacing:0.2px; }
.topbar .theme-toggle{ margin-left:auto; }

.layout{
  max-width: 1400px;
  margin: 16px auto;
  padding: 0 16px 24px;
  display:flex;
  gap:16px;
  align-items:flex-start;
}

.main-content{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.controls-panel{
  width:280px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.04);
  display:flex;
  flex-direction:column;
  gap:12px;
}

.staff-panel{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.04);
}

.hud{
  width:100%;
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  justify-content:space-between;
}
.hud .left{ display:flex; align-items:center; gap:16px; flex-wrap:wrap; }
.score{ font-weight:700; }
.feedback{ min-height: 22px; color: var(--muted); }
.feedback.ok{ color: var(--ok); }
.feedback.err{ color: var(--err); }
.beat{ display:flex; align-items:center; gap:8px; color: var(--muted); }
.lamp{ width:12px; height:12px; border-radius:50%; background:var(--lamp); box-shadow: inset 0 0 0 2px #fff, 0 0 0 1px var(--border); }
.lamp.on{ background: var(--lamp-on); box-shadow: 0 0 6px var(--lamp-on); }
.lamp.sm{ width:10px; height:10px; background: var(--lamp); }
.lamp.sm.on{ background: var(--lamp-sub); box-shadow: 0 0 4px var(--lamp-sub); }

.controls{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.btn{
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
  transition: transform .05s ease, box-shadow .1s ease;
}
.btn-small{ padding:6px 10px; font-size:12px; }
.btn:active{ transform: translateY(1px); }
.btn:hover{ box-shadow: 0 2px 8px rgba(0,0,0,.06); }
.btn:focus-visible{
  outline: 2px solid var(--focus);
  outline-offset: 2px;
}

.rhythm-controls, .qwerty-controls{
  width:100%;
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
  color: var(--muted);
}
.rhythm-controls .hint{ margin-left:auto; font-size:12px; }

.keymap-form label{
  display:inline-flex;
  align-items:center;
  gap:4px;
  margin-right:4px;
}
.keymap-form input{
  width:1.5rem;
  text-align:center;
}

.keyboard-panel{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.04);
}

.keyboard{
  position:relative;
  margin: 0 auto;
  width: 100%;
  max-width: 95vw;
  height: 18vw;
  max-height: 40vh;
  user-select:none;
}

.white{
  position:absolute;
  bottom:0;
  background:#fff;
  border:1px solid #222;
  border-bottom-left-radius:6px;
  border-bottom-right-radius:6px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  font-size:12px;
}
.white.active{ background:#e9e9e9; }
.white:focus-visible{
  outline: 2px solid var(--focus);
  outline-offset: -2px;
}

.black{
  position:absolute;
  top:0;
  background:#111;
  color:#fff;
  border:1px solid #000;
  border-bottom-left-radius:6px;
  border-bottom-right-radius:6px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  font-size:11px;
  z-index:2;
}
.black.active{ background:#333; }
.black:focus-visible{
  outline: 2px solid var(--focus);
  outline-offset: -2px;
}

.footer{
  text-align:center;
  color:var(--muted);
  padding:20px 0 36px;
}

/* Chart */
#accuracyChart{
  width: 100%;
  max-width: 760px;
  height: 160px;
  border:1px solid var(--border);
  border-radius: 10px;
  background: #fff;
  box-shadow: inset 0 0 0 1px #fafafa;
}
